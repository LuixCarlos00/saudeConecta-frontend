<div class="cadastro-container">
  <!-- Formulário do Médico -->
  <div class="cadastro-dialog">
    <!-- Header -->
    <header class="cadastro-header cadastro-header--medico">
      <div class="cadastro-header__info">
        <div class="cadastro-header__icon">
          <i class="fa-solid fa-user-doctor"></i>
        </div>
        <div>
          <h2 class="cadastro-header__title">Cadastro de Clínico</h2>
          <p class="cadastro-header__subtitle">Preencha os dados do profissional</p>
        </div>
      </div>
    </header>

    <!-- Body -->
    <div class="cadastro-body">
      <!-- Seção: Dados Pessoais -->
      <section class="cadastro-section cadastro-section--open">
        <div class="cadastro-section__header">
          <i class="fa-solid fa-user"></i>
          <h3 class="cadastro-section__title">Dados Pessoais</h3>
        </div>
        <div class="cadastro-section__body">
          <form [formGroup]="FormularioMedico" class="cadastro-grid">
            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Nome Completo
              </label>
              <input type="text" class="cadastro-field__input" formControlName="nome"
                placeholder="Digite o nome completo">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Sexo
              </label>
              <select class="cadastro-field__select" formControlName="sexo">
                <option value="" disabled>Selecione</option>
                <option value="1">Masculino</option>
                <option value="2">Feminino</option>
              </select>
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Data de Nascimento
              </label>
              <input type="date" class="cadastro-field__input" formControlName="dataNascimento">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> CPF (usado como login)
              </label>
              <input type="text" class="cadastro-field__input" formControlName="cpf" placeholder="000.000.000-00"
                maxlength="14" required (blur)="validateCpfOnBlur()">
              <div *ngIf="FormularioMedico.get('cpf')?.invalid && FormularioMedico.get('cpf')?.touched"
                class="cadastro-field__error">
                <span *ngIf="FormularioMedico.get('cpf')?.errors?.['required']">CPF é obrigatório</span>
                <span *ngIf="FormularioMedico.get('cpf')?.errors?.['cpfInvalid']">CPF inválido</span>
              </div>
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">RG</label>
              <input type="text" class="cadastro-field__input" formControlName="rg" placeholder="00.000.000-0"
                maxlength="12">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">Telefone</label>
              <input type="text" class="cadastro-field__input" formControlName="telefone" placeholder="(00) 00000-0000"
                maxlength="17">
            </div>

            <div class="cadastro-field cadastro-field--full">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Email
              </label>
              <input type="email" class="cadastro-field__input" formControlName="email" placeholder="email@exemplo.com">
            </div>
          </form>
        </div>
      </section>

      <!-- Seção: Dados Profissionais -->
      <section class="cadastro-section cadastro-section--open">
        <div class="cadastro-section__header">
          <i class="fa-solid fa-stethoscope"></i>
          <h3 class="cadastro-section__title">Dados Profissionais</h3>
        </div>
        <div class="cadastro-section__body">
          <form [formGroup]="FormularioMedico" class="cadastro-grid">
            <div class="cadastro-field cadastro-field--full">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Tipo Profissional
              </label>
              <div class="cadastro-radio-group">
                <label class="cadastro-radio">
                  <input type="radio" name="tipoProfissional" value="MEDICO" formControlName="tipoProfissional"
                    [checked]="true">
                  <span class="cadastro-radio__checkmark"></span>
                  Clínico
                </label>
                <label class="cadastro-radio">
                  <input type="radio" name="tipoProfissional" value="DENTISTA" formControlName="tipoProfissional">
                  <span class="cadastro-radio__checkmark"></span>
                  Dentista
                </label>
              </div>
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> CRM
              </label>
              <input type="text" class="cadastro-field__input" formControlName="registroConselho" placeholder="000000"
                maxlength="6">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Especialidade
              </label>
              <div style="display: flex; gap: 8px; align-items: center;">
                <select class="cadastro-field__select" formControlName="especialidade" style="flex: 1;">
                  <option value="" disabled>
                    {{ isLoadingEspecialidades ? 'Carregando especialidades...' : 'Selecione a especialidade' }}
                  </option>
                  <option *ngFor="let especialidade of especialidades" [value]="especialidade.nome">
                    {{especialidade.nome}}
                  </option>
                </select>
                <button type="button" class="cadastro-btn cadastro-btn--secondary" 
                        (click)="abrirModalNovaEspecialidade()"
                        title="Adicionar nova especialidade"
                        style="padding: 8px 12px; min-width: auto;">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
            </div>
            <div class="cadastro-field">
              <label class="cadastro-field__label">Formação</label>
              <input type="text" class="cadastro-field__input" formControlName="formacao" placeholder="Ex: Medicina">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">Instituição</label>
              <input type="text" class="cadastro-field__input" formControlName="instituicao"
                placeholder="Ex: Universidade Federal">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">Tempo de Consulta (minutos)</label>
              <input type="number" class="cadastro-field__input" formControlName="tempoConsultaMinutos" placeholder="30"
                min="5" max="120">
            </div>
          </form>
        </div>
      </section>

      <!-- Seção: Endereço -->
      <section class="cadastro-section cadastro-section--open">
        <div class="cadastro-section__header">
          <i class="fa-solid fa-location-dot"></i>
          <h3 class="cadastro-section__title">Endereço</h3>
        </div>
        <div class="cadastro-section__body">
          <form [formGroup]="FormularioEndereco" class="cadastro-grid">
            <div class="cadastro-field">
              <label class="cadastro-field__label">
                Nacionalidade
              </label>
              <input type="text" class="cadastro-field__input" formControlName="nacionalidade"
                placeholder="Brasileiro(a)">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> UF
              </label>
              <select class="cadastro-field__select" formControlName="uf">
                <option value="" disabled>Selecione</option>
                <option *ngFor="let ufOption of ufOptions" [value]="ufOption.value">
                  {{ufOption.label}}
                </option>
              </select>
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> CEP
              </label>
              <input type="text" class="cadastro-field__input" formControlName="cep" placeholder="00000-000"
                maxlength="9">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Município
              </label>
              <input type="text" class="cadastro-field__input" formControlName="municipio" placeholder="Nome da cidade">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Bairro
              </label>
              <input type="text" class="cadastro-field__input" formControlName="bairro" placeholder="Nome do bairro">
            </div>

            <div class="cadastro-field cadastro-field--full">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Rua
              </label>
              <input type="text" class="cadastro-field__input" formControlName="rua" placeholder="Nome da rua">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">
                <span class="cadastro-field__required">*</span> Número
              </label>
              <input type="number" class="cadastro-field__input" formControlName="numero" placeholder="000">
            </div>

            <div class="cadastro-field">
              <label class="cadastro-field__label">Complemento</label>
              <input type="text" class="cadastro-field__input" formControlName="complemento"
                placeholder="Apto, Bloco, etc.">
            </div>
          </form>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="cadastro-footer">
      <div class="cadastro-footer__hint">
        <i class="fa-solid fa-asterisk"></i>
        <span>Campos obrigatórios | O CPF será usado como login e a senha será enviada por email</span>
      </div>
      <div class="cadastro-footer__actions">
        <button class="cadastro-btn cadastro-btn--primary"
          [disabled]="!FormularioEndereco.valid || !FormularioMedico.valid || isLoading" (click)="cadastra()">
          <!--         -->



          <i class="fa-solid" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-check'"></i>
          {{ isLoading ? 'Cadastrando...' : 'Cadastrar Médico' }}
        </button>
      </div>
    </footer>
  </div>

  <!-- Modal: Nova Especialidade -->
  <div class="modal-overlay" *ngIf="mostrarModalNovaEspecialidade" (click)="fecharModalNovaEspecialidade()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fa-solid fa-plus-circle"></i>
          Nova Especialidade
        </h3>
        <button type="button" class="modal-close" (click)="fecharModalNovaEspecialidade()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="cadastro-field">
          <label class="cadastro-field__label">
            <span class="cadastro-field__required">*</span> Nome da Especialidade
          </label>
          <input 
            type="text" 
            class="cadastro-field__input" 
            [(ngModel)]="novaEspecialidadeNome"
            placeholder="Ex: Cardiologia Pediátrica"
            maxlength="100"
            (keyup.enter)="criarNovaEspecialidade()">
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="cadastro-btn cadastro-btn--secondary" (click)="fecharModalNovaEspecialidade()">
          <i class="fa-solid fa-times"></i>
          Cancelar
        </button>
        <button 
          type="button" 
          class="cadastro-btn cadastro-btn--primary" 
          [disabled]="!novaEspecialidadeNome || isLoading"
          (click)="criarNovaEspecialidade()">
          <i class="fa-solid" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-check'"></i>
          {{ isLoading ? 'Criando...' : 'Criar Especialidade' }}
        </button>
      </div>
    </div>
  </div>
</div>