<div class="agenda-container">
  <!-- Header da Agenda -->
  <header class="agenda-header">
    <div class="agenda-header__info">
      <h1 class="agenda-header__title">
        <i class="fa-solid fa-calendar-days"></i>
        Agenda de Consultas
      </h1>
      <p class="agenda-header__subtitle">
        Gerencie os agendamentos e consultas
      </p>
    </div>

    <!-- Filtro de Período -->
    <div class="agenda-header__period-filter">
      <span class="agenda-period-label">Período:</span>
      <div class="agenda-period-buttons">
        <button class="agenda-period-btn" [class.agenda-period-btn--active]="tipoPeriodoSelecionado === 'diario'"
          (click)="selecionarPeriodo('diario')">
          <i class="fa-solid fa-calendar-day"></i>
          Diário
        </button>
        <button class="agenda-period-btn" [class.agenda-period-btn--active]="tipoPeriodoSelecionado === 'semanal'"
          (click)="selecionarPeriodo('semanal')">
          <i class="fa-solid fa-calendar-week"></i>
          Semanal
        </button>
        <button class="agenda-period-btn" [class.agenda-period-btn--active]="tipoPeriodoSelecionado === 'mensal'"
          (click)="selecionarPeriodo('mensal')">
          <i class="fa-solid fa-calendar-days"></i>
          Mensal
        </button>
        <button class="agenda-period-btn" [class.agenda-period-btn--active]="tipoPeriodoSelecionado === 'anual'"
          (click)="selecionarPeriodo('anual')">
          <i class="fa-solid fa-calendar"></i>
          Anual
        </button>
      </div>
    </div>

    <!-- Filtro de Visualização -->
    <div class="agenda-header__filters">
      <button class="agenda-filter-btn" [class.agenda-filter-btn--active]="!Finalizadas"
        (click)="PesquisarNaTabelaAgendadas()">
        <i class="fa-solid fa-calendar-check"></i>
        Agendadas
      </button>
      <button class="agenda-filter-btn" [class.agenda-filter-btn--active]="Finalizadas"
        (click)="PesquisarNaTabelaConcluidos()">
        <i class="fa-solid fa-clipboard-check"></i>
        Finalizadas
      </button>
    </div>
  </header>

  <form [formGroup]="FormularioAgenda">
    <!-- Toolbar de Ações -->
    <div class="agenda-toolbar">
      <!-- Busca -->
      <div class="agenda-search">
        <div class="agenda-search__input-group">
          <i class="fa-solid fa-search"></i>
          <input type="text" id="busca" placeholder="Buscar por paciente, médico ou data..." formControlName="busca"
            (keyup.enter)="Pesquisar()">
        </div>
        <button class="hc-btn hc-btn--primary" type="button" (click)="Pesquisar()">
          <i class="fa-solid fa-search"></i>
          Pesquisar
        </button>
      </div>

      <!-- Ações Rápidas -->
      <div class="agenda-actions">
        <button class="agenda-action-btn" title="Recarregar Tabela" (click)="Recarregar()">
          <i class="fa-solid fa-rotate-right"></i>
          <span>Recarregar</span>
        </button>

        <button class="agenda-action-btn" title="Cronograma do dia" (click)="CronogramaDoDia()">
          <i class="fa-solid fa-clock"></i>
          <span>Cronograma</span>
        </button>
      </div>
    </div>

    <!-- Tabela de Consultas -->
    <div class="agenda-table-container">
      <div class="hc-table-wrapper">
        <table mat-table [dataSource]="dataSource" class="hc-table">

          <!-- Coluna: Código -->
          <ng-container matColumnDef="consulta">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-solid fa-hashtag"></i>
              Cód
            </th>
            <td mat-cell *matCellDef="let element">
              <span class="hc-table__code">{{ element.id }}</span>
            </td>
          </ng-container>

          <!-- Coluna: Médico -->
          <ng-container matColumnDef="medico">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-solid fa-user-doctor"></i>
              Clínico
            </th>
            <td mat-cell *matCellDef="let element">
              <div class="hc-table__person">
                <span class="hc-table__person-name">{{ element.profissionalNome }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Coluna: Paciente -->
          <ng-container matColumnDef="paciente">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-solid fa-user"></i>
              Paciente
            </th>
            <td mat-cell *matCellDef="let element">
              <div class="hc-table__person hc-table__person--patient">
                <span class="hc-table__person-name">{{ element.pacienteNome }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Coluna: Dia da Semana -->
          <ng-container matColumnDef="diaSemana">
            <th mat-header-cell *matHeaderCellDef>Dia</th>
            <td mat-cell *matCellDef="let element">
              <span class="hc-table__day">{{ element.dataHora | diaSemana }}</span>
            </td>
          </ng-container>

          <!-- Coluna: Data -->
          <ng-container matColumnDef="data">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-regular fa-calendar"></i>
              Data
            </th>
            <td mat-cell *matCellDef="let element">
              <span class="hc-table__date">{{ element.dataHora | date: 'dd/MM/yyyy' }}</span>
            </td>
          </ng-container>

          <!-- Coluna: Horário -->
          <ng-container matColumnDef="horario">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-regular fa-clock"></i>
              Horário
            </th>
            <td mat-cell *matCellDef="let element">
              <span class="hc-table__time">{{ element.dataHora | horario }}</span>
            </td>
          </ng-container>

          <!-- Coluna: Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>
              <i class="fa-solid fa-circle-info"></i>
              Status
            </th>
            <td mat-cell *matCellDef="let element">
              <select
                class="hc-status-select"
                [class.hc-status-select--agendada]="element.status === 'AGENDADA'"
                [class.hc-status-select--confirmada]="element.status === 'CONFIRMADA'"
                [class.hc-status-select--realizada]="element.status === 'REALIZADA'"
                [class.hc-status-select--cancelada]="element.status === 'CANCELADA'"
                [attr.disabled]="(element.status === 'REALIZADA' || element.status === 'CANCELADA') ? true : null"
                (change)="AlterarStatus(element, $any($event.target).value)">
                <option value="AGENDADA" [selected]="element.status === 'AGENDADA'">Agendada</option>
                <option value="CONFIRMADA" [selected]="element.status === 'CONFIRMADA'">Confirmada</option>
                <option *ngIf="Finalizadas" value="REALIZADA" [selected]="element.status === 'REALIZADA'">Realizada</option>
                <option value="CANCELADA" [selected]="element.status === 'CANCELADA'">Cancelada</option>
              </select>
            </td>
          </ng-container>

          <!-- Coluna: Ações -->
          <ng-container matColumnDef="Seleciona">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let element">
              <div class="hc-table__actions">
                <!-- Observações -->
                <button *ngIf="element.observacao" class="hc-action-btn hc-action-btn--info" title="Ver Observações"
                  (click)="Observacoes(element.observacao)">
                  <i class="fa-solid fa-note-sticky"></i>
                </button>

                <!-- Enviar Aviso -->
                <!-- <button class="hc-action-btn hc-action-btn--primary" title="Enviar Aviso"
                  (click)="EnviarAviso(element)">
                  <i class="fa-solid fa-paper-plane"></i>
                </button> -->

                <!-- Gerar Link Questionário (somente antes da finalização) -->
                <button *ngIf="element.status !== 'REALIZADA'" class="hc-action-btn hc-action-btn--teal" title="Gerar Link do Questionário de Saúde"
                  (click)="gerarLinkQuestionario(element)">
                  <i class="fa-solid fa-link"></i>
                </button>

                <!-- Gerar Link Planejamento Terapêutico (somente após finalização) -->
                <button *ngIf="element.status === 'REALIZADA'" class="hc-action-btn hc-action-btn--teal" title="Gerar Link do Planejamento Terapêutico"
                  (click)="gerarLinkPlanejamento(element)">
                  <i class="fa-solid fa-file-signature"></i>
                </button>

                <!-- Editar -->
                <button class="hc-action-btn hc-action-btn--warning" title="Editar Consulta" [disabled]="Finalizadas"
                  (click)="Editar(element)">
                  <i class="fa-solid fa-pen-to-square"></i>
                </button>

<!--                &lt;!&ndash; Concluir &ndash;&gt;-->
<!--                <button class="hc-action-btn hc-action-btn&#45;&#45;success" title="Concluir Consulta" [disabled]="Finalizadas"-->
<!--                  (click)="Concluido(element)">-->
<!--                  <i class="fa-solid fa-check"></i>-->
<!--                </button>-->

                <!-- Imprimir -->
                <button class="hc-action-btn hc-action-btn--primary" title="Opções de Impressão"
                  (click)="AbrirOpcoesImpressao(element)">
                  <i class="fa-solid fa-print"></i>
                </button>

                <!-- Excluir -->
                <button class="hc-action-btn hc-action-btn--danger" title="Excluir Consulta" [disabled]="Finalizadas"
                  (click)="Deletar(element)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.hc-table__row--completed]="Finalizadas">
          </tr>
        </table>

        <!-- Estado Vazio -->
        <div class="hc-table__empty" *ngIf="dataSource.length === 0">
          <i class="fa-solid fa-calendar-xmark"></i>
          <p>Nenhuma consulta encontrada</p>
          <button class="hc-btn hc-btn--primary" (click)="Recarregar()">
            <i class="fa-solid fa-rotate-right"></i>
            Recarregar
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
